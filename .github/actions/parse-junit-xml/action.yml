name: Parse Pytest JUnit XML
description: Simple action to parse JUnit XML files generated by Pytest and output a text summary of tests run
inputs:
  filepath:
    required: true
    description: Path to JUnit XML file to parse (e.g. "test_report.xml")
outputs:
  summary:
    value: "${{ steps.parse_test_report.outputs.summary }}"
    description: Multiline string list of tests run and their results
runs:
  using: "composite"
  steps:
    - name: Set up Python
      id: cp311
      uses: actions/setup-python@v5
      with:
        python-version: 3.11
        update-environment: false

    - name: Parse Pytest JUnit XML
      id: parse_test_report
      shell: bash
      run: |
        # Use python script in parse-junit-xml directory to parse the pytest report
        ${{ steps.cp311.outputs.python-path }} ${{ github.action_path }}/parse_junit_xml.py \
          --filepath ${{ inputs.filepath }} \
          --output-filepath tmp-result.txt

        # Save multiline file output to a summary 
        echo 'summary<<EOF' >> $GITHUB_OUTPUT
        cat tmp-result.txt >> $GITHUB_OUTPUT
        echo 'EOF' >> $GITHUB_OUTPUT

        # Clean up the summary file
        rm tmp-result.txt